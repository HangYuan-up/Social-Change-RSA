rm(list=ls())#删除目前所有的变量

library(foreign)
library(wesanderson)
library(psych)
library(pheatmap)
library(ade4)
library(readxl)
library(ggplot2)
library(Hmisc)
#模型构建：跨时间的多变量表征相似性矩阵（地区尺度，意间-时间维度）
##以北京老年人认知功能为例
CLHLSdata <- read_excel(".../cognition_beijing.xlsx")
cognition_beijing<- CLHLSdata[c(1:6),c(2:9)]
cognition_beijing<- as.data.frame(cognition_beijing)
cognition_beijing_1998.dists <- dist(cognition_beijing[,1])
cognition_beijing_2000.dists <- dist(cognition_beijing[,2])
cognition_beijing_2002.dists <- dist(cognition_beijing[,3])
cognition_beijing_2005.dists <- dist(cognition_beijing[,4])
cognition_beijing_2008.dists <- dist(cognition_beijing[,5])
cognition_beijing_2011.dists <- dist(cognition_beijing[,6])
cognition_beijing_2014.dists <- dist(cognition_beijing[,7])
cognition_beijing_2018.dists <- dist(cognition_beijing[,8])
a1998<-as.matrix(cognition_beijing_1998.dists)
a2000<-as.matrix(cognition_beijing_2000.dists)
a2002<-as.matrix(cognition_beijing_2002.dists)
a2005<-as.matrix(cognition_beijing_2005.dists)
a2008<-as.matrix(cognition_beijing_2008.dists)
a2011<-as.matrix(cognition_beijing_2011.dists)
a2014<-as.matrix(cognition_beijing_2014.dists)
a2018<-as.matrix(cognition_beijing_2018.dists)
a1998<-1-(a1998-min(a1998))/(max(a1998)-min(a1998))
a2000<-1-(a2000-min(a2000))/(max(a2000)-min(a2000))
a2002<-1-(a2002-min(a2002))/(max(a2002)-min(a2002))
a2005<-1-(a2005-min(a2005))/(max(a2005)-min(a2005))
a2008<-1-(a2008-min(a2008))/(max(a2008)-min(a2008))
a2011<-1-(a2011-min(a2011))/(max(a2011)-min(a2011))
a2014<-1-(a2014-min(a2014))/(max(a2014)-min(a2014))
a2018<-1-(a2018-min(a2018))/(max(a2018)-min(a2018))
cognition_beijing1998<-as.matrix(a1998[lower.tri(a1998)])
cognition_beijing2000<-as.matrix(a2000[lower.tri(a2000)])
cognition_beijing2002<-as.matrix(a2002[lower.tri(a2002)])
cognition_beijing2005<-as.matrix(a2005[lower.tri(a2005)])
cognition_beijing2008<-as.matrix(a2008[lower.tri(a2008)])
cognition_beijing2011<-as.matrix(a2011[lower.tri(a2011)])
cognition_beijing2014<-as.matrix(a2014[lower.tri(a2014)])
cognition_beijing2018<-as.matrix(a2018[lower.tri(a2018)])
cognition_beijing_total<-cbind(cognition_beijing1998,cognition_beijing2000,cognition_beijing2002,cognition_beijing2005,
                               cognition_beijing2008,cognition_beijing2011,cognition_beijing2014,cognition_beijing2018)
cognition_beijing_totalr<-cor(cognition_beijing_total,method="pearson")
pheatmap(cognition_beijing_totalr,cluster_rows = FALSE, cluster_cols = FALSE,border_color = "gray",
         color = c(colorRampPalette(colors = c("#097CFF","white"))(82),
                   colorRampPalette(colors = c("white","red"))(18)),
         legend_breaks=seq(0.54,1,0.2),angle_col=45)